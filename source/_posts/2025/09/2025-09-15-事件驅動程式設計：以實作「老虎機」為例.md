---
title: äº‹ä»¶é©…å‹•ç¨‹å¼è¨­è¨ˆï¼šä»¥å¯¦ä½œã€Œè€è™æ©Ÿã€ç‚ºä¾‹
date: 2025-09-15 23:50:53
tags: ["Programming", "JavaScript", "Event-driven"]
categories: ["Programming", "JavaScript", "Others"]
---

## å‰è¨€

æœ¬æ–‡ä½¿ç”¨ OOP å°è£é‚è¼¯ï¼Œç·´ç¿’å¤šç¨®äº‹ä»¶è¨­è¨ˆï¼Œé€éã€Œè€è™æ©Ÿã€ç¯„ä¾‹ç†è§£äº‹ä»¶é©…å‹•ç¨‹å¼è¨­è¨ˆçš„æ ¸å¿ƒæ¦‚å¿µã€‚

## ç°¡ä»‹

ç¨‹å¼çš„æµç¨‹ä¸é å–®ä¸€ç·šæ€§åŸ·è¡Œï¼Œè€Œæ˜¯ç”±ç‰©ä»¶ç‹€æ…‹æˆ–å¤–éƒ¨è¡Œç‚ºè§¸ç™¼äº‹ä»¶ï¼Œäº‹ä»¶è§¸ç™¼ç›¸æ‡‰å›å‘¼ï¼ˆè™•ç†å‡½å¼ï¼‰ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

- äº‹ä»¶ï¼ˆEventï¼‰ï¼šç‰©ä»¶ç‹€æ…‹æ”¹è®Šæˆ–æ“ä½œå®Œæˆçš„è¨Šè™Ÿ
- å›å‘¼ï¼ˆCallback/Handlerï¼‰ï¼šå°äº‹ä»¶çš„éŸ¿æ‡‰å‡½å¼
- ä¸»å‹•æˆ–è¢«å‹•è§¸ç™¼ï¼š
  - ä¸»å‹•ï¼šå‘¼å«å‡½å¼åŸ·è¡Œå‹•ä½œ
  - è¢«å‹•ï¼šäº‹ä»¶ç™¼ç”Ÿæ™‚è‡ªå‹•åŸ·è¡Œå›å‘¼
- ä¾‹å­ï¼š
  - æŒ‰éˆ•é»æ“Šï¼š`onClick`
  - å€’æ•¸è¨ˆæ™‚å™¨ï¼š`onTick`

äº‹ä»¶é©…å‹•æ˜¯ callback çš„é€²éšæŠ½è±¡ï¼Œç”¨æ–¼å¤šäº‹ä»¶ã€å¤šè¨‚é–±è€…çš„æƒ…å¢ƒï¼Œé™ä½è€¦åˆã€‚

## ç°¡å–®ç·´ç¿’

ä»¥ä¸‹åšä¸€å€‹ç°¡å–®çš„ã€Œå€’æ•¸è¨ˆæ™‚ã€ç·´ç¿’ï¼Œç†è§£ã€Œäº‹ä»¶ã€å’Œã€Œå›å‘¼ã€çš„æ¦‚å¿µã€‚

### å»ºç«‹éåŒæ­¥å‡½å¼

å»ºç«‹ `playground/countdown.js` æª”ã€‚

```js

const countdown = (seconds) => {
  let remaining = seconds;
  const timer = setInterval(() => {
    remaining--;

    if (remaining <= 0) {
      console.log('â° Time up!');
      clearInterval(timer);
    }
  }, 1000);
};

// 3 seconds countdown
countdown(3);
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node playground/countdown.js
```

ç¶“é 3 ç§’ï¼Œè¼¸å‡ºå¦‚ä¸‹ï¼š

```bash
â° Time up!
```

### æä¾›å›å‘¼æ–¹æ³•

å¦‚æœæƒ³è¦åœ¨å€’æ•¸è¨ˆæ™‚çµæŸæ™‚é€šçŸ¥ï¼Œå°±è¦åšä¸€å€‹å« `onTimeUp` çš„ callback æ–¹æ³•ã€‚

```js
const countdown = (seconds, onTimeUp) => {
  let remaining = seconds;
  const timer = setInterval(() => {
    remaining--;

    if (remaining <= 0) {
      console.log('â° Time up!');
      clearInterval(timer);
      if (onTimeUp) onTimeUp();
    }
  }, 1000);
};

// 3 seconds countdown
countdown(3, () => {
  console.log('ğŸ‰ Countdown finished!');
});
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node playground/countdown.js
```

ç¶“é 3 ç§’ï¼Œè¼¸å‡ºå¦‚ä¸‹ï¼š

```bash
â° Time up!
ğŸ‰ Countdown finished!
```

### å¯¦ç¾ä¸­é€”é€šçŸ¥

å¦‚æœæƒ³è¦é€²ä¸€æ­¥åœ¨æ¯ä¸€ç§’æ™‚é€šçŸ¥ï¼Œå°±è¦å†åšä¸€å€‹ `onTick` çš„ callback æ–¹æ³•ã€‚

```js
const countdown = ({ seconds, onTick, onTimeUp }) => {
  let remaining = seconds;
  const timer = setInterval(() => {
    remaining--;

    if (remaining > 0) {
      if (onTick) onTick(remaining);
    }

    if (remaining <= 0) {
      clearInterval(timer);
      console.log('â° Time up!');
      if (onTimeUp) onTimeUp();
    }
  }, 1000);
};

// 3 seconds countdown
countdown({
  seconds: 3,
  onTick: (remaining) => console.log(`â³ ${remaining} seconds remaining...`),
  onTimeUp: () => console.log('ğŸ‰ Countdown finished!'),
});
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node playground/countdown.js
```

ç¶“é 3 ç§’ï¼Œè¼¸å‡ºå¦‚ä¸‹ï¼š

```bash
â³ 2 seconds remaining...
â³ 1 seconds remaining...
â° Time up!
ğŸ‰ Countdown finished!
```

### äº‹ä»¶ï¼å›å‘¼ vs async/await

å»ºç«‹ `playground/countdownAsync.js` æª”ã€‚

```js
const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

const countdownAsync = async (ms) => {
  await delay(ms);
  console.log('â° Time up!');
};

await countdownAsync(3000);
console.log('ğŸ‰ Countdown finished!');
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node playground/countdownAsync.js
```

ç¶“é 3 ç§’ï¼Œè¼¸å‡ºå¦‚ä¸‹ï¼š

```bash
â° Time up!
ğŸ‰ Countdown finished!
```

| ç‰¹æ€§             | å›å‘¼ / äº‹ä»¶          | async/await              |
| -------------- | ---------------- | ------------------------ |
| æ”¯æ´å¤š handler    | âœ…                | âŒï¼ˆéœ€é¡å¤–è¨­è¨ˆï¼‰                 |
| æ¯ç§’ tick / ä¸­é€”é€šçŸ¥ | âœ…                | âŒï¼ˆéœ€é¡å¤–è¿´åœˆå’Œ awaitï¼‰          |
| å¯«æ³•ç·šæ€§å¯è®€         | âŒï¼ˆcallback å¯èƒ½å·¢ç‹€ï¼‰ | âœ…                        |

## å»ºç«‹å°ˆæ¡ˆ

å»ºç«‹å°ˆæ¡ˆã€‚

```bash
npm create vite@latest

> npx
> create-vite

â”‚
â—‡  Project name:
â”‚  event-driven-slot-machine
â”‚
â—‡  Select a framework:
â”‚  Vue
â”‚
â—‡  Select a variant:
â”‚  JavaScript
â”‚
â—‡  Scaffolding project in
```

## å¯¦ä½œé¡åˆ¥

### å±¬æ€§æŒ‡æ´¾å¼

æŠŠäº‹ä»¶ handler ç›´æ¥æŒ‡æ´¾çµ¦ç‰©ä»¶å±¬æ€§ã€‚

ç‰¹é»ï¼š

- èˆŠå¼ DOM API / æ—©æœŸ JS å¸¸è¦‹ï¼šåƒ `element.onclick = ...`ã€‚
- æ¯å€‹äº‹ä»¶åªä¿ç•™ä¸€å€‹ handlerï¼Œæ–°çš„æŒ‡æ´¾æœƒè¦†è“‹èˆŠçš„ handlerã€‚
- ç°¡å–®æ˜“æ‡‚ï¼Œä½†ç¼ºä¹å¤šé‡è¨‚é–±èƒ½åŠ›ã€‚

å»ºç«‹ `lib/OldSlotMachine.js` æª”æ¡ˆã€‚

```js
class OldSlotMachine {
  constructor(reels = 3, symbols = ['7ï¸âƒ£', 'ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡', 'ğŸŒ', 'ğŸ“', 'ğŸ””']) {
    this.reels = reels;        // Number of reels
    this.symbols = symbols;    // Possible symbols
    this.currentReels = Array(this.reels).fill(null);

    // Old-style event properties
    this.onReset = null;
    this.onSpinStart = null;
    this.onReelStop = null;
    this.onAllReelsStop = null;
    this.onWin = null;
    this.onLose = null;
    this.onJackpot = null;
  }

  // Reset reels
  reset() {
    this.currentReels = Array(this.reels).fill(null);
    if (this.onReset) this.onReset();
  }

  // Generate symbol for single reel
  spinReel() {
    const idx = Math.floor(Math.random() * this.symbols.length);
    return this.symbols[idx];
  }

  // Player pulls lever
  spin() {
    if (this.onSpinStart) this.onSpinStart();

    this.currentReels = [];

    // Simulate each reel stopping
    for (let i = 0; i < this.reels; i++) {
      const symbol = this.spinReel();
      this.currentReels.push(symbol);
      if (this.onReelStop) this.onReelStop(i + 1, symbol);
    }

    if (this.onAllReelsStop) this.onAllReelsStop(this.currentReels);

    // Determine result
    const [first] = this.currentReels;
    const win = this.currentReels.every(s => s === first);

    if (!win) {
      if (this.onLose) this.onLose(this.currentReels);
      return;
    }

    if (first === '7ï¸âƒ£') {
      if (this.onJackpot) this.onJackpot(this.currentReels);
      return;
    }

    if (this.onWin) this.onWin(this.currentReels);
  }
}

export default OldSlotMachine;
```

å»ºç«‹ `lib/demoOldSlotMachine.js` æª”ã€‚

```js
import OldSlotMachine from './OldSlotMachine.js';

const machine = new OldSlotMachine();

// Register events
machine.onSpinStart = () => console.log('Pull the lever! Start spinning!');
machine.onReelStop = (i, symbol) => console.log(`Reel ${i} stopped: ${symbol}`);
machine.onAllReelsStop = reels => console.log('All reels stopped!');
machine.onWin = reels => console.log(`You win! Reels: ${reels}`);
machine.onLose = reels => console.log(`You lose! Reels: ${reels}`);
machine.onJackpot = reels => console.log(`JACKPOT!!! Reels: ${reels}`);
machine.onReset = () => console.log('Reels have been reset!');

// Demo
machine.reset();
machine.spin();
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node lib/demoOldSlotMachine.js
```

è¼¸å‡ºçµæœå¦‚ä¸‹ï¼š

```bash
Reels have been reset!
Pull the lever! Start spinning!
Reel 1 stopped: ğŸŠ
Reel 2 stopped: ğŸ’
Reel 3 stopped: ğŸŒ
All reels stopped!
You lose! Reels: ğŸŠ,ğŸ’,ğŸŒ
```

### è¨»å†Šå‡½å¼å¼

å‘¼å«ä¸€å€‹æ–¹æ³•ï¼Œå°‡ handler è¨»å†Šåˆ°äº‹ä»¶åˆ—è¡¨ä¸­ã€‚

ç‰¹é»ï¼š

- å¯ä»¥è¨»å†Šå¤šå€‹ handlerï¼Œäº’ä¸è¦†è“‹ã€‚
- é¡ä¼¼ DOM ç¾ä»£ API çš„ addEventListenerã€‚
- é©åˆ OOP å°è£çš„äº‹ä»¶é©…å‹•æ¶æ§‹ã€‚

å»ºç«‹ `lib/SlotMachine.js` æª”æ¡ˆã€‚

```js
class SlotMachine {

  constructor(reels = 3, symbols = ['7ï¸âƒ£', 'ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡', 'ğŸŒ', 'ğŸ“', 'ğŸ””']) {
    this.reels = reels;        // Number of reels
    this.symbols = symbols;    // Possible symbols
    this.events = {};          // Store event callbacks
  }

  // Register event callback
  on(eventName, callback) {
    if (!this.events[eventName]) this.events[eventName] = [];
    this.events[eventName].push(callback);
  }

  // Trigger event
  emit(eventName, ...args) {
    (this.events[eventName] || []).forEach(cb => cb(...args));
  }

  // Reset reels
  reset() {
    this.currentReels = Array(this.reels).fill(null);
    this.emit('reset');
  }

  // Generate symbol for single reel
  spinReel() {
    const idx = Math.floor(Math.random() * this.symbols.length);
    return this.symbols[idx];
  }

  // Player pulls lever
  spin() {
    this.emit('spinStart');

    this.currentReels = [];

    // Simulate each reel stopping
    for (let i = 0; i < this.reels; i++) {
      const symbol = this.spinReel();
      this.currentReels.push(symbol);
      this.emit('reelStop', i + 1, symbol);
    }

    this.emit('allReelsStop', this.currentReels);

    // Determine result
    const [first] = this.currentReels;
    const win = this.currentReels.every(s => s === first);

    if (!win) {
      this.emit('lose', this.currentReels);
      return;
    }
    if (first === '7ï¸âƒ£') {
      this.emit('jackpot', this.currentReels);
      return;
    }
    this.emit('win', this.currentReels);
  }
}

export default SlotMachine;
```

å»ºç«‹ `lib/demoSlotMachine.js` æª”ã€‚

```js
import SlotMachine from './SlotMachine.js';

const machine = new SlotMachine();

// Register events
machine.on('spinStart', () => console.log('Pull the lever! Start spinning!'));
machine.on('reelStop', (i, symbol) => console.log(`Reel ${i} stopped: ${symbol}`));
machine.on('allReelsStop', reels => console.log('All reels stopped!'));
machine.on('win', reels => console.log(`You win! Reels: ${reels}`));
machine.on('lose', reels => console.log(`You lose! Reels: ${reels}`));
machine.on('jackpot', reels => console.log(`JACKPOT!!! Reels: ${reels}`));
machine.on('reset', () => console.log('Reels have been reset!'));

// Demo
machine.reset();
machine.spin();
```

åŸ·è¡Œè…³æœ¬ã€‚

```bash
node lib/demoSlotMachine.js
```

è¼¸å‡ºçµæœå¦‚ä¸‹ï¼š

```bash
Reels have been reset!
Pull the lever! Start spinning!
Reel 1 stopped: ğŸ“
Reel 2 stopped: 7ï¸âƒ£
Reel 3 stopped: ğŸ‡
All reels stopped!
You lose! Reels: ğŸ“,7ï¸âƒ£,ğŸ‡
```

### æ–¹æ³•éˆ

å¦‚æœå¸Œæœ›å¯ä»¥é€£çºŒè¨»å†Šå¤šå€‹äº‹ä»¶å›å‘¼ï¼Œå¯ä»¥è®“ `on` æ–¹æ³•å›å‚³è‡ªèº«ï¼ˆthisï¼‰ï¼Œä»¥å¯¦ç¾æ–¹æ³•éˆï¼ˆmethod chainingï¼‰ã€‚

```js
// Register event callback
on(eventName, callback) {
  if (!this.events[eventName]) this.events[eventName] = [];
  this.events[eventName].push(callback);

  return this;
}
```

## å¯¦ä½œä»‹é¢

å»ºç«‹ `src/components/SlotMachine.vue` æª”ã€‚

```html
<script setup>
import SlotMachine from '../../lib/SlotMachine';

const props = defineProps({
  reels: {
    type: Number,
    default: undefined,
  },
  symbols: {
    type: Array,
    default: undefined,
  },
  onSpinStart: {
    type: Function,
    default: () => {},
  },
  onReelStop: {
    type: Function,
    default: () => {},
  },
  onAllReelsStop: {
    type: Function,
    default: () => {},
  },
  onWin: {
    type: Function,
    default: () => {},
  },
  onLose: {
    type: Function,
    default: () => {},
  },
  onJackpot: {
    type: Function,
    default: () => {},
  },
  onReset: {
    type: Function,
    default: () => {},
  },
});

const machine = new SlotMachine(props.reels, props.symbols);

machine.on('spinStart', () => props.onSpinStart);
machine.on('reelStop', (i, symbol) => props.onReelStop(i, symbol));
machine.on('allReelsStop', reels => props.onAllReelsStop(reels));
machine.on('win', reels => props.onWin(reels));
machine.on('lose', reels => props.onLose(reels));
machine.on('jackpot', reels => props.onJackpot(reels));
machine.on('reset', () => props.onReset());

const handleClick = () => {
  machine.reset();
  machine.spin();
};
</script>

<template>
  <button
    @click="handleClick"
  >
    Spin
  </button>
</template>
```

å»ºç«‹ `src/components/SlotMachineBasic.vue` æª”ã€‚

```html
<script setup>
import { ref } from 'vue';
import SlotMachine from './SlotMachine.vue';

const resultRef = ref();
const prizeRef = ref();

const awardPrize = (amount) => {};
const playAnimation = () => {};
const notifyLeaderboard = () => {};

const handleWin = reels => {
  const amount = 100;
  awardPrize(amount);
  notifyLeaderboard();
  resultRef.value.textContent = `You win! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};

const handleLose = reels => {
  const amount = 0;
  resultRef.value.textContent = `You lose! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};

const handleJackpot = reels => {
  const amount = 1000;
  awardPrize(amount);
  notifyLeaderboard();
  playAnimation();
  resultRef.value.textContent = `JACKPOT!!! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};
</script>

<template>
  <div class="card">
    <h3>The Pro Slot Machine</h3>
    <SlotMachine
      :reels="3"
      :symbols="['7ï¸âƒ£', 'ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡']"
      :on-win="handleWin"
      :on-lose="handleLose"
      :on-jackpot="handleJackpot"
    />
    <h4>
      <span ref="resultRef">&nbsp;</span>
      <br>
      <span ref="prizeRef" style="margin-left: 0.5em">&nbsp;</span>
    </h4>
  </div>
</template>
```

å»ºç«‹ `src/components/SlotMachinePro.vue` æª”ã€‚

```html
<script setup>
import { ref } from 'vue';
import SlotMachine from './SlotMachine.vue';

const resultRef = ref();
const prizeRef = ref();

const awardPrize = (amount) => {};
const playAnimation = () => {};
const notifyLeaderboard = () => {};

const handleWin = reels => {
  const amount = 500;
  awardPrize(amount);
  notifyLeaderboard();
  resultRef.value.textContent = `You win! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};

const handleLose = reels => {
  const amount = 0;
  resultRef.value.textContent = `You lose! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};

const handleJackpot = reels => {
  const amount = 5000;
  awardPrize(amount);
  notifyLeaderboard();
  playAnimation();
  resultRef.value.textContent = `JACKPOT!!! Reels: ${reels}`;
  prizeRef.value.textContent = `+${amount} coins`;
};
</script>

<template>
  <div class="card">
    <h3>The Pro Slot Machine</h3>
    <SlotMachine
      :reels="5"
      :symbols="['7ï¸âƒ£', 'ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡', 'ğŸŒ', 'ğŸ“']"
      :on-win="handleWin"
      :on-lose="handleLose"
      :on-jackpot="handleJackpot"
    />
    <h4>
      <span ref="resultRef">&nbsp;</span>
      <br>
      <span ref="prizeRef" style="margin-left: 0.5em">&nbsp;</span>
    </h4>
  </div>
</template>
```

ä¿®æ”¹ `src/App.vue` æª”ã€‚

```html
<script setup>
import SlotMachineBasic from './components/SlotMachineBasic.vue';
import SlotMachinePro from './components/SlotMachinePro.vue';

</script>

<template>
  <SlotMachineBasic />
  <SlotMachinePro />
</template>
```

å•Ÿå‹•å°ˆæ¡ˆã€‚

```bash
npm run dev
```

## ç¨‹å¼ç¢¼

- [event-driven-slot-machine](https://github.com/memochou1993/event-driven-slot-machine)
