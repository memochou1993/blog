---
title: 《白話區塊鏈》學習筆記（四）：智慧合約與交易結算
permalink: 《白話區塊鏈》學習筆記（四）：智慧合約與交易結算
date: 2020-03-25 17:23:06
tags: ["區塊鏈"]
categories: ["區塊鏈", "《白話區塊鏈》學習筆記"]
---

## 前言

本文為《白話區塊鏈》一書的學習筆記。

## 區塊鍊擴充應用：智慧合約

合約管理系統實際上早就存在了，然而區塊鍊系統為智慧合約的實作提供了一個更加有創意而吸引人的方案。

### 比特幣中包含的合約思維

做為一個分散式、去中心的網路系統，比特幣在運作過程中除了發起交易外，並不需要某個人再做審核確定，所有的環節例如驗證資料合法性、轉移所有權、打包區塊等，都是按照既定的規則自動運作的。

例如，Alice 準備了一張支票然後簽上自己的名字，又在支票上放了一個只有 Bob 知道謎底的謎語，只有 Bob 能說出謎底。因此這張支票代表的一筆款項，其所有權就轉移給了 Bob，當 Bob 提供謎底時，這張支票就生效了，相當於執行合約。

在比特幣的區塊鍊網路中，持續不斷地發生著轉帳交易，在每個參與節點的共同見證下，轉換每一筆交易輸出的所有權，不斷進行著鎖定與解鎖，這就是比特幣系統中包含的合約思想。

### 以太坊中圖靈完備的合約支援

以太坊是一個完全重新開發的獨立的公有區塊鍊系統，本身也支援一種加密數位貨幣，稱之為以太幣。不過以太坊真正強大之處在於支援使用者自定的合約編程，支援全面的合約程式開發。最主要的就是支援了圖靈完備的開發語言，編寫的合約程式編譯後是運作在以太坊虛擬機上。以太坊支援四種合約程式語言如下：

- solidity，類似 JavaScript；
- serpent，類似 Python；
- Mutan，類似 Go；
- LLL，類似 Lisp。

官方推薦是 solidity，使用自訂合約編程可以實作各種商業邏輯，例如眾籌合約、利潤分配合約、擔保合約，和貨幣兌換合約等，當然也可以實作直接的數位貨幣合約。由於以太坊支援的是圖靈完備的開發語言，因此幾乎可以編寫任意複雜邏輯的合約程式，這些被部署到以太坊上的合約程式，會受到以太坊基礎區塊鍊系統的約束，擁有公有區塊鍊系統的一切特點，例如資料公開透明、不可竄改等。

## 交易結算

其實比特幣的目標是要創造一個數位化的自由金融體系，可以讓任意種類的資產進行點對點的直接交易，不需要一個中心化的服務商。

### 銀行結算清算

區塊鍊模式的結算、清算流程和邏輯如下：

1. 用戶、用戶發卡銀行、商家、支付服務商、商家銀行、（央行）結算清算中心等所有利益相關者都在一個共享帳本的對等網路中。

2. 建立在對等網路上的共享帳本，天然的做法就是用區塊鍊對等網路部署共享帳本，可以在商業流程中各個利益相關者之間同步和傳遞。

3. 所有的商業流程都記錄在共享帳本上，有權力記帳的節點可以記帳，需要確認的節點可以確認，所有活動都記錄在帳本上。

4. 帳本上的資料分公開資料和私密資料，根據權限連線公開資料和完全私密資料，按照應用情境分類。

5. 用戶互動，包括刷卡、商家確認、提交支付服務商、請求提交商家銀行、提交結算與清算行、結算與清算結果確認、支付和收款確認所有活動，都記錄在公共帳本上。

6. 結算與清算的邏輯部署在公共帳本所藏身的鍊式資料中，各個節點根據共識機制與是先定義和編寫好的智慧合約自動進行。

### 瑞波：開放支付網路

瑞波（Ripple），也就是瑞波支付以及瑞波幣（XRP），它既是一種數位貨幣也是一種支付協定，類似於哈瓦拉網路：一種傳統的、在城與城之間的非數位化方式。哈瓦拉始於中世紀的阿拉伯半島，現今仍在銀行無法經營的地區使用，是獨立於傳統銀行金融管道的非正統、非主流匯款系統，可以簡單地把哈瓦拉看成是一種地下匯兌。

如果 Alice 想要匯款給 Bob，在哈瓦拉體系中會如下進行：

1. Alice 找他的當地哈瓦拉代理人，把現金以及他和 Bob 共享的密碼交給代理人；

2. Alice 的代理人打電話給 Bob 的代理人，告訴他把資金發放給能提供密碼的人；

3. Bob 找到他的代理人，提供密碼並得到現金；

4. 交易過程中的傭金可能被一方或雙方代理人接收。

這裡的代理人其實就是閘道（Gateway）或交易中心。在瑞波網路中，可以透過中間代理閘道，在代理商之間建立信任鍊，透過它來進行中轉。也可以透過瑞波幣，進入瑞波網路的結算網路，結合瑞波網的智慧合約，實作不可竄改、擔保等各項安全措施。

## 參考資料

- 蔣勇、文延、嘉文（2018）。白話區塊鏈。台北市：碁峯資訊。
