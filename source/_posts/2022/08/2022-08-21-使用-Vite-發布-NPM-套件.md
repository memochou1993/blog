---
title: 使用 Vite 發布 NPM 套件
permalink: 使用-Vite-發布-NPM-套件
date: 2022-08-21 12:24:58
tags: ["程式設計", "JavaScript", "Vite", "npm"]
categories: ["程式設計", "JavaScript", "其他"]
---

## 實作

建立專案。

```BASH
npm create vite
cd vite-library-example
```

修改 `main.js` 檔，建立主程式。

```JS
const hello = () => {
  console.log('Hello');
};

export {
  hello,
}
```

新增 `vite.config.js` 檔。

```JS
import { resolve } from 'path';
import { defineConfig } from 'vite';

export default defineConfig({
  build: {
    lib: {
      entry: resolve(__dirname, 'main.js'),
      name: 'MyLib',
      fileName: 'my-lib',
    },
    rollupOptions: {
      external: [
        //
      ],
      output: {
        globals: {
          //
        },
      },
    },
  },
});
```

修改 `package.json` 檔。

```JSON
{
  "name": "@memochou1993/vite-library-example",
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^3.0.9"
  },
  "files": [
    "dist"
  ],
  "main": "./dist/my-lib.umd.cjs",
  "module": "./dist/my-lib.js",
  "exports": {
    ".": {
      "import": "./dist/my-lib.js",
      "require": "./dist/my-lib.umd.cjs"
    }
  }
}
```

執行編譯，並監聽變化。

```BASH
npm run build -- --watch
```

## 預覽

### 使用 UMD 標準引入

新增 `preview.umd.js` 檔。

```JS
MyLib.hello();
```

修改 `index.html` 檔，將編譯好的套件引入。

```HTML
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script src="dist/my-lib.umd.cjs"></script>
    <script src="/preview.umd.js"></script>
  </body>
</html>
```

啟動服務。

```BASH
npm run dev
```

### 使用 ES 模組引入

新增 `preview.js` 檔。

```JS
import { hello } from './dist/my-lib';

hello();
```

修改 `index.html` 檔，將編譯好的套件引入。

```HTML
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="dist/my-lib.js"></script>
    <script type="module" src="/preview.js"></script>
  </body>
</html>
```

啟動服務。

```BASH
npm run dev
```

## 發布

測試發布，查看即將發布的檔案列表。

```BASH
npm publish --dry-run
```

登入 `npm` 套件管理平台。

```BASH
npm login
```

發布套件。

```BASH
npm publish --access=public
```

### 使用

下載套件。

```BASH
npm i @memochou1993/vite-library-example
```

新增 `preview.npm.js` 檔。

```JS
import { hello } from '@memochou1993/vite-library-example';

hello();
```

修改 `index.html` 檔，將編譯好的套件引入。

```HTML
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/preview.npm.js"></script>
  </body>
</html>
```

## 程式碼

- [vite-library-example](https://github.com/memochou1993/vite-library-example)

## 參考資料

- [Vite - Library Mode](https://vitejs.dev/guide/build.html#library-mode)
