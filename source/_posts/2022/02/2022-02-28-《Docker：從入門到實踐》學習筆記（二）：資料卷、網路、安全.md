---
title: 《Docker：從入門到實踐》學習筆記（二）：資料卷、網路、安全
permalink: 《Docker：從入門到實踐》學習筆記（二）：資料卷、網路、安全
date: 2022-02-27 20:36:06
tags: ["環境部署", "Docker"]
categories: ["環境部署", "Docker", "《Docker：從入門到實踐》學習筆記"]
---

## 前言

本文複習 Docker 相關概念與指令。

## 資料卷

資料卷是一種可供一或多個容器使用的特殊目錄，它繞過 UFS（通用快閃記憶體儲存），提供很多有用的特性：

- 資料卷可以在容器之間共享和重用。
- 對資料卷的修改會立即生效。
- 對資料卷的更新，不會影響映像檔。
- 卷會一直存在，直到沒有容器使用。

### 建立資料卷

使用 `-v` 參數建立一個資料卷並掛載到容器裡。

```BASH
docker run -ti --name test -v /dbdata ubuntu bash
```

也可以指定掛載一個本地主機的目錄到容器裡。

```BASH
docker run -ti --name test -v ~/Workspace/docker:/dbdata ubuntu bash
```

注意，本地目錄的路徑必須是絕對路徑，如果目錄不存在，Docker 會自動建立。

Docker 掛載資料卷的預設權限是讀寫，使用者也可以透過 `:ro` 參數指定為唯讀。

```BASH
docker run -ti --name test -v ~/Workspace/docker:/dbdata:ro ubuntu bash
```

### 建立資料卷容器

如果有一些持續更新的資料需要在容器之間共享，最好建立資料卷容器。資料卷容器其實就是一個一般的容器，專門用來提供資料卷供其它容器掛載。

首先，建立一個名為 `dbdata` 的資料卷容器。

```BASH
docker run -d --name dbdata -v /dbdata ubuntu
```

然後，在其他容器中使用 `--volumes-from` 參數來掛載 `dbdata` 容器中的資料卷。

```BASH
docker run -d --volumes-from dbdata --name test1 ubuntu
docker run -d --volumes-from dbdata --name test2 ubuntu
```

使用 `docker rm -v` 命令來刪除關聯的容器。

```BASH
docker rm -v dbdata test1 test2
```

### 備份

首先，建立一個名為 `dbdata` 的資料卷容器。

```BASH
docker run -t -d --name dbdata -v /dbdata ubuntu
```

使用 `--volumes-from` 參數來建立一個載入 `dbdata` 容器卷的容器，並從本地主機掛載當前目錄到容器的 `/backup` 目錄，再使用 `tar` 指令進行壓縮。

```BASH
docker run --volumes-from dbdata -v $(pwd):/backup ubuntu tar cvfP /backup/backup.tar /dbdata
```

### 復原

首先，建立一個名為 `dbdata2` 的資料卷容器。

```BASH
docker run -t -d --name dbdata2 -v /dbdata ubuntu
```

使用 `--volumes-from` 參數來建立一個載入 `dbdata2` 容器卷的容器，並從本地主機掛載當前目錄到容器的 `/backup` 目錄，再使用 `tar` 指令進行解壓縮。

```BASH
docker run -t -d --volumes-from dbdata2 -v $(pwd):/backup ubuntu tar xvfP /backup/backup.tar
```

## 網路

TODO

## 安全

TODO

## 參考資料

- [Docker：從入門到實踐](https://github.com/yeasy/docker_practice)
